<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Licensing System - Payment Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            background-color: #fff;
        }
        
        .sidebar-sticky {
            position: relative;
            top: 0;
            height: calc(100vh - 48px);
            padding-top: .5rem;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .navbar-brand {
            padding-top: .75rem;
            padding-bottom: .75rem;
            font-size: 1rem;
            background-color: rgba(0, 0, 0, .25);
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .25);
        }
        
        .navbar .navbar-toggler {
            top: .25rem;
            right: 1rem;
        }
        
        .main-content {
            margin-left: 240px;
            padding: 20px;
        }
        
        .payment-gateway {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        
        .payment-gateway-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .payment-gateway-logo {
            width: 40px;
            height: 40px;
            margin-right: 15px;
        }
        
        .payment-gateway-title {
            font-size: 1.25rem;
            font-weight: 500;
            margin: 0;
        }
        
        .payment-gateway-status {
            margin-left: auto;
        }
        
        .form-switch {
            padding-left: 2.5em;
        }
        
        .form-switch .form-check-input {
            width: 3em;
            height: 1.5em;
            margin-left: -2.5em;
        }
        
        .test-mode-badge {
            background-color: #ffc107;
            color: #000;
            font-size: 0.75rem;
            padding: 0.25em 0.5em;
            border-radius: 0.25rem;
            margin-left: 10px;
        }
        
        .live-mode-badge {
            background-color: #198754;
            color: #fff;
            font-size: 0.75rem;
            padding: 0.25em 0.5em;
            border-radius: 0.25rem;
            margin-left: 10px;
        }
        
        .webhook-url {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            word-break: break-all;
        }
        
        .copy-btn {
            cursor: pointer;
            color: #0d6efd;
        }
        
        .copy-btn:hover {
            color: #0a58ca;
        }
        
        .alert {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Licensing System</a>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="w-100"></div>
        <ul class="navbar-nav px-3">
            <li class="nav-item text-nowrap">
                <a class="nav-link" href="/admin/logout">Sign out</a>
            </li>
        </ul>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3 sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/dashboard">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/licenses">
                                <i class="bi bi-key"></i> Licenses
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/clients">
                                <i class="bi bi-people"></i> Clients
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/products">
                                <i class="bi bi-box"></i> Products
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/admin/payment-settings">
                                <i class="bi bi-credit-card"></i> Payment Settings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/settings">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/documentation">
                                <i class="bi bi-book"></i> Documentation
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Payment Settings</h1>
                </div>
                
                <div class="alert alert-success" id="success-alert" role="alert">
                    <i class="bi bi-check-circle-fill"></i> <span id="success-message"></span>
                </div>
                
                <div class="alert alert-danger" id="error-alert" role="alert">
                    <i class="bi bi-exclamation-triangle-fill"></i> <span id="error-message"></span>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">General Payment Settings</h5>
                            </div>
                            <div class="card-body">
                                <form id="general-settings-form">
                                    <div class="mb-3">
                                        <label for="currency" class="form-label">Default Currency</label>
                                        <select class="form-select" id="currency" name="currency">
                                            <option value="USD">USD - US Dollar</option>
                                            <option value="EUR">EUR - Euro</option>
                                            <option value="GBP">GBP - British Pound</option>
                                            <option value="CAD">CAD - Canadian Dollar</option>
                                            <option value="AUD">AUD - Australian Dollar</option>
                                            <option value="JPY">JPY - Japanese Yen</option>
                                            <option value="INR">INR - Indian Rupee</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="tax_rate" class="form-label">Default Tax Rate (%)</label>
                                        <input type="number" class="form-control" id="tax_rate" name="tax_rate" min="0" max="100" step="0.01">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="auto_activate" name="auto_activate">
                                            <label class="form-check-label" for="auto_activate">Automatically activate licenses after payment</label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="send_invoice" name="send_invoice">
                                            <label class="form-check-label" for="send_invoice">Send invoice email after payment</label>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Save General Settings</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3 class="mb-4">Payment Gateways</h3>
                
                <!-- Stripe Payment Gateway -->
                <div class="payment-gateway" id="stripe-gateway">
                    <div class="payment-gateway-header">
                        <img src="/static/images/stripe-logo.png" alt="Stripe" class="payment-gateway-logo">
                        <h4 class="payment-gateway-title">Stripe</h4>
                        <div class="payment-gateway-status">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="stripe_enabled" name="stripe_enabled">
                                <label class="form-check-label" for="stripe_enabled">Enabled</label>
                            </div>
                        </div>
                    </div>
                    
                    <form id="stripe-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="stripe_mode" class="form-label">Mode</label>
                                    <select class="form-select" id="stripe_mode" name="stripe_mode">
                                        <option value="test">Test Mode</option>
                                        <option value="live">Live Mode</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="stripe_webhook" class="form-label">Webhook Secret</label>
                                    <input type="password" class="form-control" id="stripe_webhook" name="stripe_webhook">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="stripe_publishable_key" class="form-label">Publishable Key</label>
                                    <input type="text" class="form-control" id="stripe_publishable_key" name="stripe_publishable_key">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="stripe_secret_key" class="form-label">Secret Key</label>
                                    <input type="password" class="form-control" id="stripe_secret_key" name="stripe_secret_key">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Webhook URL</label>
                            <div class="webhook-url">
                                <span id="stripe-webhook-url">https://yourdomain.com/api/webhooks/stripe</span>
                                <i class="bi bi-clipboard copy-btn ms-2" data-clipboard-target="#stripe-webhook-url"></i>
                            </div>
                            <div class="form-text">Add this URL to your Stripe webhook settings.</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Stripe Settings</button>
                    </form>
                </div>
                
                <!-- PayPal Payment Gateway -->
                <div class="payment-gateway" id="paypal-gateway">
                    <div class="payment-gateway-header">
                        <img src="/static/images/paypal-logo.png" alt="PayPal" class="payment-gateway-logo">
                        <h4 class="payment-gateway-title">PayPal</h4>
                        <div class="payment-gateway-status">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="paypal_enabled" name="paypal_enabled">
                                <label class="form-check-label" for="paypal_enabled">Enabled</label>
                            </div>
                        </div>
                    </div>
                    
                    <form id="paypal-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="paypal_mode" class="form-label">Mode</label>
                                    <select class="form-select" id="paypal_mode" name="paypal_mode">
                                        <option value="sandbox">Sandbox Mode</option>
                                        <option value="live">Live Mode</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="paypal_webhook" class="form-label">Webhook ID</label>
                                    <input type="text" class="form-control" id="paypal_webhook" name="paypal_webhook">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="paypal_client_id" class="form-label">Client ID</label>
                                    <input type="text" class="form-control" id="paypal_client_id" name="paypal_client_id">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="paypal_secret" class="form-label">Secret</label>
                                    <input type="password" class="form-control" id="paypal_secret" name="paypal_secret">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Webhook URL</label>
                            <div class="webhook-url">
                                <span id="paypal-webhook-url">https://yourdomain.com/api/webhooks/paypal</span>
                                <i class="bi bi-clipboard copy-btn ms-2" data-clipboard-target="#paypal-webhook-url"></i>
                            </div>
                            <div class="form-text">Add this URL to your PayPal webhook settings.</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save PayPal Settings</button>
                    </form>
                </div>
                
                <!-- Square Payment Gateway -->
                <div class="payment-gateway" id="square-gateway">
                    <div class="payment-gateway-header">
                        <img src="/static/images/square-logo.png" alt="Square" class="payment-gateway-logo">
                        <h4 class="payment-gateway-title">Square</h4>
                        <div class="payment-gateway-status">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="square_enabled" name="square_enabled">
                                <label class="form-check-label" for="square_enabled">Enabled</label>
                            </div>
                        </div>
                    </div>
                    
                    <form id="square-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="square_mode" class="form-label">Mode</label>
                                    <select class="form-select" id="square_mode" name="square_mode">
                                        <option value="sandbox">Sandbox Mode</option>
                                        <option value="live">Live Mode</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="square_webhook" class="form-label">Webhook Signature Key</label>
                                    <input type="password" class="form-control" id="square_webhook" name="square_webhook">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="square_application_id" class="form-label">Application ID</label>
                                    <input type="text" class="form-control" id="square_application_id" name="square_application_id">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="square_access_token" class="form-label">Access Token</label>
                                    <input type="password" class="form-control" id="square_access_token" name="square_access_token">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Webhook URL</label>
                            <div class="webhook-url">
                                <span id="square-webhook-url">https://yourdomain.com/api/webhooks/square</span>
                                <i class="bi bi-clipboard copy-btn ms-2" data-clipboard-target="#square-webhook-url"></i>
                            </div>
                            <div class="form-text">Add this URL to your Square webhook settings.</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Square Settings</button>
                    </form>
                </div>
                
                <!-- Authorize.net Payment Gateway -->
                <div class="payment-gateway" id="authorizenet-gateway">
                    <div class="payment-gateway-header">
                        <img src="/static/images/authorizenet-logo.png" alt="Authorize.net" class="payment-gateway-logo">
                        <h4 class="payment-gateway-title">Authorize.net</h4>
                        <div class="payment-gateway-status">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="authorizenet_enabled" name="authorizenet_enabled">
                                <label class="form-check-label" for="authorizenet_enabled">Enabled</label>
                            </div>
                        </div>
                    </div>
                    
                    <form id="authorizenet-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="authorizenet_mode" class="form-label">Mode</label>
                                    <select class="form-select" id="authorizenet_mode" name="authorizenet_mode">
                                        <option value="sandbox">Sandbox Mode</option>
                                        <option value="live">Live Mode</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="authorizenet_api_login_id" class="form-label">API Login ID</label>
                                    <input type="text" class="form-control" id="authorizenet_api_login_id" name="authorizenet_api_login_id">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="authorizenet_transaction_key" class="form-label">Transaction Key</label>
                                    <input type="password" class="form-control" id="authorizenet_transaction_key" name="authorizenet_transaction_key">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Webhook URL</label>
                            <div class="webhook-url">
                                <span id="authorizenet-webhook-url">https://yourdomain.com/api/webhooks/authorizenet</span>
                                <i class="bi bi-clipboard copy-btn ms-2" data-clipboard-target="#authorizenet-webhook-url"></i>
                            </div>
                            <div class="form-text">Add this URL to your Authorize.net webhook settings.</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Authorize.net Settings</button>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize clipboard.js
            new ClipboardJS('.copy-btn');
            
            // Get DOM elements
            const successAlert = document.getElementById('success-alert');
            const successMessage = document.getElementById('success-message');
            const errorAlert = document.getElementById('error-alert');
            const errorMessage = document.getElementById('error-message');
            
            // General settings form
            const generalSettingsForm = document.getElementById('general-settings-form');
            
            // Payment gateway forms
            const stripeForm = document.getElementById('stripe-form');
            const paypalForm = document.getElementById('paypal-form');
            const squareForm = document.getElementById('square-form');
            const authorizenetForm = document.getElementById('authorizenet-form');
            
            // Payment gateway toggles
            const stripeEnabled = document.getElementById('stripe_enabled');
            const paypalEnabled = document.getElementById('paypal_enabled');
            const squareEnabled = document.getElementById('square_enabled');
            const authorizenetEnabled = document.getElementById('authorizenet_enabled');
            
            // Mode selects
            const stripeMode = document.getElementById('stripe_mode');
            const paypalMode = document.getElementById('paypal_mode');
            const squareMode = document.getElementById('square_mode');
            const authorizenetMode = document.getElementById('authorizenet_mode');
            
            // Load settings from server
            fetch('/admin/api/payment-settings', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('admin_token')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Set general settings
                    document.getElementById('currency').value = data.settings.currency || 'USD';
                    document.getElementById('tax_rate').value = data.settings.tax_rate || '0';
                    document.getElementById('auto_activate').checked = data.settings.auto_activate || false;
                    document.getElementById('send_invoice').checked = data.settings.send_invoice || false;
                    
                    // Set Stripe settings
                    if (data.settings.stripe) {
                        stripeEnabled.checked = data.settings.stripe.enabled || false;
                        stripeMode.value = data.settings.stripe.mode || 'test';
                        document.getElementById('stripe_publishable_key').value = data.settings.stripe.publishable_key || '';
                        document.getElementById('stripe_secret_key').value = data.settings.stripe.secret_key || '';
                        document.getElementById('stripe_webhook').value = data.settings.stripe.webhook_secret || '';
                    }
                    
                    // Set PayPal settings
                    if (data.settings.paypal) {
                        paypalEnabled.checked = data.settings.paypal.enabled || false;
                        paypalMode.value = data.settings.paypal.mode || 'sandbox';
                        document.getElementById('paypal_client_id').value = data.settings.paypal.client_id || '';
                        document.getElementById('paypal_secret').value = data.settings.paypal.secret || '';
                        document.getElementById('paypal_webhook').value = data.settings.paypal.webhook_id || '';
                    }
                    
                    // Set Square settings
                    if (data.settings.square) {
                        squareEnabled.checked = data.settings.square.enabled || false;
                        squareMode.value = data.settings.square.mode || 'sandbox';
                        document.getElementById('square_application_id').value = data.settings.square.application_id || '';
                        document.getElementById('square_access_token').value = data.settings.square.access_token || '';
                        document.getElementById('square_webhook').value = data.settings.square.webhook_signature_key || '';
                    }
                    
                    // Set Authorize.net settings
                    if (data.settings.authorizenet) {
                        authorizenetEnabled.checked = data.settings.authorizenet.enabled || false;
                        authorizenetMode.value = data.settings.authorizenet.mode || 'sandbox';
                        document.getElementById('authorizenet_api_login_id').value = data.settings.authorizenet.api_login_id || '';
                        document.getElementById('authorizenet_transaction_key').value = data.settings.authorizenet.transaction_key || '';
                    }
                } else {
                    // Display error message
                    errorMessage.textContent = data.message || 'Failed to load payment settings.';
                    errorAlert.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                errorMessage.textContent = 'An error occurred while loading payment settings.';
                errorAlert.style.display = 'block';
            });
            
            // Handle general settings form submission
            generalSettingsForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    currency: document.getElementById('currency').value,
                    tax_rate: document.getElementById('tax_rate').value,
                    auto_activate: document.getElementById('auto_activate').checked,
                    send_invoice: document.getElementById('send_invoice').checked
                };
                
                // Hide any previous messages
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
                
                // Send request to server
                fetch('/admin/api/payment-settings/general', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('admin_token')
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        successMessage.textContent = 'General payment settings saved successfully.';
                        successAlert.style.display = 'block';
                    } else {
                        // Display error message
                        errorMessage.textContent = data.message || 'Failed to save general payment settings.';
                        errorAlert.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMessage.textContent = 'An error occurred while saving general payment settings.';
                    errorAlert.style.display = 'block';
                });
            });
            
            // Handle Stripe form submission
            stripeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    enabled: stripeEnabled.checked,
                    mode: stripeMode.value,
                    publishable_key: document.getElementById('stripe_publishable_key').value,
                    secret_key: document.getElementById('stripe_secret_key').value,
                    webhook_secret: document.getElementById('stripe_webhook').value
                };
                
                // Hide any previous messages
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
                
                // Send request to server
                fetch('/admin/api/payment-settings/stripe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('admin_token')
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        successMessage.textContent = 'Stripe settings saved successfully.';
                        successAlert.style.display = 'block';
                    } else {
                        // Display error message
                        errorMessage.textContent = data.message || 'Failed to save Stripe settings.';
                        errorAlert.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMessage.textContent = 'An error occurred while saving Stripe settings.';
                    errorAlert.style.display = 'block';
                });
            });
            
            // Handle PayPal form submission
            paypalForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    enabled: paypalEnabled.checked,
                    mode: paypalMode.value,
                    client_id: document.getElementById('paypal_client_id').value,
                    secret: document.getElementById('paypal_secret').value,
                    webhook_id: document.getElementById('paypal_webhook').value
                };
                
                // Hide any previous messages
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
                
                // Send request to server
                fetch('/admin/api/payment-settings/paypal', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('admin_token')
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        successMessage.textContent = 'PayPal settings saved successfully.';
                        successAlert.style.display = 'block';
                    } else {
                        // Display error message
                        errorMessage.textContent = data.message || 'Failed to save PayPal settings.';
                        errorAlert.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMessage.textContent = 'An error occurred while saving PayPal settings.';
                    errorAlert.style.display = 'block';
                });
            });
            
            // Handle Square form submission
            squareForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    enabled: squareEnabled.checked,
                    mode: squareMode.value,
                    application_id: document.getElementById('square_application_id').value,
                    access_token: document.getElementById('square_access_token').value,
                    webhook_signature_key: document.getElementById('square_webhook').value
                };
                
                // Hide any previous messages
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
                
                // Send request to server
                fetch('/admin/api/payment-settings/square', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('admin_token')
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        successMessage.textContent = 'Square settings saved successfully.';
                        successAlert.style.display = 'block';
                    } else {
                        // Display error message
                        errorMessage.textContent = data.message || 'Failed to save Square settings.';
                        errorAlert.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMessage.textContent = 'An error occurred while saving Square settings.';
                    errorAlert.style.display = 'block';
                });
            });
            
            // Handle Authorize.net form submission
            authorizenetForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    enabled: authorizenetEnabled.checked,
                    mode: authorizenetMode.value,
                    api_login_id: document.getElementById('authorizenet_api_login_id').value,
                    transaction_key: document.getElementById('authorizenet_transaction_key').value
                };
                
                // Hide any previous messages
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
                
                // Send request to server
                fetch('/admin/api/payment-settings/authorizenet', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('admin_token')
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        successMessage.textContent = 'Authorize.net settings saved successfully.';
                        successAlert.style.display = 'block';
                    } else {
                        // Display error message
                        errorMessage.textContent = data.message || 'Failed to save Authorize.net settings.';
                        errorAlert.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMessage.textContent = 'An error occurred while saving Authorize.net settings.';
                    errorAlert.style.display = 'block';
                });
            });
            
            // Update webhook URLs based on mode
            stripeMode.addEventListener('change', function() {
                const mode = this.value;
                const baseUrl = window.location.origin;
                document.getElementById('stripe-webhook-url').textContent = `${baseUrl}/api/webhooks/stripe`;
            });
            
            paypalMode.addEventListener('change', function() {
                const mode = this.value;
                const baseUrl = window.location.origin;
                document.getElementById('paypal-webhook-url').textContent = `${baseUrl}/api/webhooks/paypal`;
            });
            
            squareMode.addEventListener('change', function() {
                const mode = this.value;
                const baseUrl = window.location.origin;
                document.getElementById('square-webhook-url').textContent = `${baseUrl}/api/webhooks/square`;
            });
            
            authorizenetMode.addEventListener('change', function() {
                const mode = this.value;
                const baseUrl = window.location.origin;
                document.getElementById('authorizenet-webhook-url').textContent = `${baseUrl}/api/webhooks/authorizenet`;
            });
        });
    </script>
</body>
</html> 